<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Wincash</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  :root{
    --bg:#0b0b20;
    --header:#151532;
    --card:#1d1f2e;
    --accent:#b8a3ff;
    --green:#33ff77;
    --red:#ff3366;
    --blue:#3366ff;
    --yellow:#ffcc00;
  }

  *{
    margin:0;
    padding:0;
    box-sizing:border-box;
  }

  body{
    font-family:'Poppins', sans-serif;
    background:var(--bg);
    color:white;
    min-height:100vh;
    overflow-x: hidden;
  }

  .admin-header{
    background:var(--header);
    padding:20px 5%;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 2px 15px rgba(0,0,0,0.4);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .admin-title{
    font-size:24px;
    font-weight:600;
    color:var(--red);
  }

  .header-buttons{
    display:flex;
    gap:10px;
  }

  .withdrawal-btn{
    background:var(--green);
    color:#0b0b20;
    border:none;
    padding:10px 20px;
    border-radius:8px;
    cursor:pointer;
    font-family:'Poppins', sans-serif;
    font-weight:600;
    transition: all 0.3s;
  }

  .withdrawal-btn:hover{
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(51,255,119,0.4);
  }

  .logout-btn{
    background:var(--red);
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:8px;
    cursor:pointer;
    font-family:'Poppins', sans-serif;
    transition: all 0.3s;
  }

  .logout-btn:hover{
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255,51,102,0.4);
  }

  .stats-container{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
    gap:20px;
    padding:30px 5%;
  }

  .stat-card{
    background:var(--card);
    padding:25px;
    border-radius:15px;
    text-align:center;
    border:2px solid;
    transition: all 0.3s;
  }

  .stat-card:hover{
    transform: translateY(-5px);
  }

  .stat-card:nth-child(1){ border-color: var(--blue); }
  .stat-card:nth-child(2){ border-color: var(--green); }
  .stat-card:nth-child(3){ border-color: var(--yellow); }
  .stat-card:nth-child(4){ border-color: var(--accent); }

  .stat-number{
    font-size:36px;
    font-weight:600;
    margin:10px 0;
  }

  .stat-card:nth-child(1) .stat-number{ color: var(--blue); }
  .stat-card:nth-child(2) .stat-number{ color: var(--green); }
  .stat-card:nth-child(3) .stat-number{ color: var(--yellow); }
  .stat-card:nth-child(4) .stat-number{ color: var(--accent); }

  .users-table{
    background:var(--card);
    margin:30px 5%;
    border-radius:15px;
    padding:25px;
    overflow-x:auto;
  }

  table{
    width:100%;
    border-collapse:collapse;
  }

  th, td{
    padding:15px;
    text-align:left;
    border-bottom:1px solid #333366;
  }

  th{
    background:rgba(51,102,255,0.2);
    color:var(--accent);
  }

  .delete-btn{
    background:var(--red);
    color:white;
    border:none;
    padding:8px 15px;
    border-radius:5px;
    cursor:pointer;
    transition: all 0.3s;
  }

  .delete-btn:hover{
    background: #ff1a4d;
    transform: scale(1.05);
  }

  .export-btn{
    background:var(--green);
    color:#0b0b20;
    border:none;
    padding:12px 25px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    margin:20px 0;
    transition: all 0.3s;
  }

  .export-btn:hover{
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(51,255,119,0.4);
  }

  .action-buttons{
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }

  .refresh-btn{
    background: var(--blue);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
  }

  .refresh-btn:hover{
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(51,102,255,0.4);
  }

  .no-users{
    text-align: center;
    padding: 40px;
    color: #bbb;
    font-size: 18px;
  }

  .user-actions{
    display: flex;
    gap: 5px;
  }

  /* Withdrawal Requests Section */
  .withdrawal-section {
    background: var(--card);
    margin: 30px 5%;
    border-radius: 15px;
    padding: 25px;
    overflow-x: auto;
  }

  .section-title {
    color: var(--accent);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .status-badge {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
  }

  .status-pending {
    background: rgba(255, 204, 0, 0.2);
    color: var(--yellow);
  }

  .status-approved {
    background: rgba(51, 255, 119, 0.2);
    color: var(--green);
  }

  .status-rejected {
    background: rgba(255, 51, 102, 0.2);
    color: var(--red);
  }

  .action-btn {
    padding: 6px 12px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    font-size: 12px;
    font-weight: 600;
    transition: all 0.3s;
    margin: 2px;
  }

  .approve-btn {
    background: var(--green);
    color: #0b0b20;
  }

  .approve-btn:hover {
    background: #28e06a;
  }

  .reject-btn {
    background: var(--red);
    color: white;
  }

  .reject-btn:hover {
    background: #ff1a4d;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
  }

  .modal-content {
    background: var(--card);
    border-radius: 15px;
    padding: 30px;
    width: 90%;
    max-width: 600px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    margin: 20px;
    max-height: 90vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    position: sticky;
    top: 0;
    background: var(--card);
    padding: 10px 0;
    z-index: 1;
  }

  .modal-title {
    font-size: 20px;
    color: var(--accent);
  }

  .close-btn {
    background: none;
    border: none;
    color: #bbb;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s;
    padding: 5px;
    touch-action: manipulation;
  }

  .close-btn:hover {
    color: var(--red);
  }

  .payment-methods {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    margin: 20px 0;
  }

  .payment-method {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid transparent;
    border-radius: 10px;
    padding: 18px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  .payment-method:hover {
    border-color: var(--accent);
    transform: translateY(-3px);
  }

  .payment-method.selected {
    border-color: var(--green);
    background: rgba(51, 255, 119, 0.1);
  }

  .payment-icon {
    font-size: 28px;
    margin-bottom: 8px;
    pointer-events: none;
  }

  .bkash { color: #e2136e; }
  .nagad { color: #f8a01c; }
  .rocket { color: #9b59b6; }
  .upay { color: #27ae60; }
  .binance { color: #f0b90b; }
  .payoneer { color: #0073aa; }
  .paypal { color: #003087; }
  .skrill { color: #9200b0; }
  .neteller { color: #ff6600; }
  .perfect-money { color: #e41e26; }
  .webmoney { color: #045ba5; }
  .crypto { color: #00ff88; }
  .bank { color: #3366ff; }

  .method-form {
    margin-top: 20px;
  }

  .form-group {
    margin-bottom: 15px;
  }

  .form-group label {
    display: block;
    margin-bottom: 5px;
    color: var(--accent);
    font-weight: 600;
  }

  .form-group input {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #333366;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    font-family: 'Poppins', sans-serif;
    font-size: 16px;
    touch-action: manipulation;
  }

  .form-group input:focus {
    outline: none;
    border-color: var(--accent);
  }

  .save-btn {
    background: var(--green);
    color: #0b0b20;
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    width: 100%;
    transition: all 0.3s;
    touch-action: manipulation;
  }

  .save-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(51,255,119,0.4);
  }

  /* Bulk Actions */
  .bulk-actions {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .bulk-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .bulk-approve {
    background: var(--green);
    color: #0b0b20;
  }

  .bulk-reject {
    background: var(--red);
    color: white;
  }

  /* Mobile specific styles */
  @media (max-width: 768px) {
    .modal-content {
      margin: 10px;
      padding: 20px;
      width: 95%;
    }
    
    .payment-methods {
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .payment-method {
      padding: 15px;
    }
    
    .payment-icon {
      font-size: 24px;
    }
    
    .admin-header {
      flex-direction: column;
      gap: 15px;
    }
    
    .header-buttons {
      width: 100%;
      justify-content: center;
    }
    
    .stats-container {
      grid-template-columns: 1fr 1fr;
    }
    
    .bulk-actions {
      flex-direction: column;
    }
  }

  @media (max-width: 480px) {
    .stats-container {
      grid-template-columns: 1fr;
    }
    
    .payment-methods {
      grid-template-columns: 1fr;
    }
    
    .action-buttons {
      flex-direction: column;
    }
    
    .action-buttons button {
      width: 100%;
    }
  }

  body.modal-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100%;
  }
</style>
</head>
<body>

<div class="admin-header">
  <div class="admin-title">
    <i class="fas fa-crown"></i> Wincash Admin Dashboard
  </div>
  <div class="header-buttons">
    <button class="withdrawal-btn" onclick="openWithdrawalMethods()">
      <i class="fas fa-wallet"></i> Withdrawal Methods
    </button>
    <button class="logout-btn" onclick="adminLogout()">
      <i class="fas fa-sign-out-alt"></i> Logout
    </button>
  </div>
</div>

<div class="stats-container">
  <div class="stat-card">
    <i class="fas fa-users" style="color:var(--blue); font-size:24px;"></i>
    <div class="stat-number" id="totalUsers">0</div>
    <div>Total Users</div>
  </div>

  <div class="stat-card">
    <i class="fas fa-money-bill-wave" style="color:var(--green); font-size:24px;"></i>
    <div class="stat-number" id="totalEarnings">$0.00</div>
    <div>Total Earnings</div>
  </div>

  <div class="stat-card">
    <i class="fas fa-tasks" style="color:var(--yellow); font-size:24px;"></i>
    <div class="stat-number" id="totalTasks">0</div>
    <div>Tasks Completed</div>
  </div>

  <div class="stat-card">
    <i class="fas fa-calendar-day" style="color:var(--accent); font-size:24px;"></i>
    <div class="stat-number" id="todayUsers">0</div>
    <div>Today's Signups</div>
  </div>
</div>

<!-- Withdrawal Requests Section -->
<div class="withdrawal-section">
  <h2 class="section-title">
    <i class="fas fa-money-bill-wave"></i> Withdrawal Requests
    <span style="font-size: 14px; color: #bbb; margin-left: 10px;" id="pendingCount">(0 Pending)</span>
  </h2>
  
  <div class="bulk-actions">
    <button class="bulk-btn bulk-approve" onclick="approveAllPending()">
      <i class="fas fa-check-double"></i> Approve All Pending
    </button>
    <button class="bulk-btn bulk-reject" onclick="rejectAllPending()">
      <i class="fas fa-times-circle"></i> Reject All Pending
    </button>
    <button class="refresh-btn" onclick="loadWithdrawalData()">
      <i class="fas fa-sync-alt"></i> Refresh
    </button>
  </div>
  
  <table>
    <thead>
      <tr>
        <th>User</th>
        <th>Method</th>
        <th>Account</th>
        <th>Amount</th>
        <th>Date</th>
        <th>Status</th>
        <th>User Balance</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="withdrawalsTableBody">
      <!-- Withdrawals will be loaded here -->
    </tbody>
  </table>

  <div id="noWithdrawalsMessage" class="no-users" style="display: none;">
    <i class="fas fa-money-bill-wave" style="font-size: 48px; margin-bottom: 15px;"></i>
    <div>No withdrawal requests</div>
    <div style="font-size: 14px; margin-top: 10px;">Withdrawal requests will appear here when users request payments</div>
  </div>
</div>

<div class="users-table">
  <h2 style="margin-bottom:20px; color: var(--accent);">
    <i class="fas fa-users"></i> All Users
  </h2>
  
  <div class="action-buttons">
    <button class="export-btn" onclick="exportUsers()">
      <i class="fas fa-download"></i> Export Users Data
    </button>
    <button class="refresh-btn" onclick="loadUsersData()">
      <i class="fas fa-sync-alt"></i> Refresh Data
    </button>
  </div>
  
  <table>
    <thead>
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Balance</th>
        <th>Join Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="usersTableBody">
      <!-- Users data will be loaded here -->
    </tbody>
  </table>

  <div id="noUsersMessage" class="no-users" style="display: none;">
    <i class="fas fa-users-slash" style="font-size: 48px; margin-bottom: 15px;"></i>
    <div>No users found</div>
    <div style="font-size: 14px; margin-top: 10px;">Users will appear here when they sign up</div>
  </div>
</div>

<!-- Footer -->
<div class="footer">
  <p><strong>Wincash</strong> is a platform that contains those offered content for users.</p>
  <p>&copy; 2025 Paidmoney - Join us - Support - We are awesome</p>
</div>

<!-- Withdrawal Methods Modal -->
<div class="modal" id="withdrawalModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Withdrawal Methods Setup</h3>
      <button class="close-btn" onclick="closeModal('withdrawalModal')">&times;</button>
    </div>
    <div class="modal-body">
      <p>Select and configure withdrawal methods for your users:</p>
      
      <div class="payment-methods">
        <!-- Bangladeshi Methods -->
        <div class="payment-method" onclick="selectMethod('bkash')">
          <div class="payment-icon bkash">
            <i class="fas fa-mobile-alt"></i>
          </div>
          <div>Bkash</div>
        </div>
        
        <div class="payment-method" onclick="selectMethod('nagad')">
          <div class="payment-icon nagad">
            <i class="fas fa-wallet"></i>
          </div>
          <div>Nagad</div>
        </div>
        
        <div class="payment-method" onclick="selectMethod('rocket')">
          <div class="payment-icon rocket">
            <i class="fas fa-rocket"></i>
          </div>
          <div>Rocket</div>
        </div>
        
        <div class="payment-method" onclick="selectMethod('upay')">
          <div class="payment-icon upay">
            <i class="fas fa-bolt"></i>
          </div>
          <div>Upay</div>
        </div>

        <!-- International Methods -->
        <div class="payment-method" onclick="selectMethod('binance')">
          <div class="payment-icon binance">
            <i class="fab fa-bitcoin"></i>
          </div>
          <div>Binance</div>
        </div>
        
        <div class="payment-method" onclick="selectMethod('paypal')">
          <div class="payment-icon paypal">
            <i class="fab fa-paypal"></i>
          </div>
          <div>PayPal</div>
        </div>
        
        <div class="payment-method" onclick="selectMethod('payoneer')">
          <div class="payment-icon payoneer">
            <i class="fas fa-globe"></i>
          </div>
          <div>Payoneer</div>
        </div>
        
        <div class="payment-method" onclick="selectMethod('skrill')">
          <div class="payment-icon skrill">
            <i class="fas fa-money-bill"></i>
          </div>
          <div>Skrill</div>
        </div>
        
        <div class="payment-method" onclick="selectMethod('neteller')">
          <div class="payment-icon neteller">
            <i class="fas fa-credit-card"></i>
          </div>
          <div>Neteller</div>
        </div>
        
        <div class="payment-method" onclick="selectMethod('perfect-money')">
          <div class="payment-icon perfect-money">
            <i class="fas fa-money-check"></i>
          </div>
          <div>Perfect Money</div>
        </div>
        
        <div class="payment-method" onclick="selectMethod('webmoney')">
          <div class="payment-icon webmoney">
            <i class="fas fa-wallet"></i>
          </div>
          <div>WebMoney</div>
        </div>
        
        <div class="payment-method" onclick="selectMethod('crypto')">
          <div class="payment-icon crypto">
            <i class="fab fa-ethereum"></i>
          </div>
          <div>Crypto Wallet</div>
        </div>
        
        <div class="payment-method" onclick="selectMethod('bank')">
          <div class="payment-icon bank">
            <i class="fas fa-university"></i>
          </div>
          <div>Bank Transfer</div>
        </div>
      </div>
      
      <div class="method-form" id="methodForm" style="display: none;">
        <div class="form-group">
          <label id="methodLabel">Account Details</label>
          <input type="text" id="accountInput" placeholder="Enter account details">
        </div>
        <div class="form-group">
          <label>Minimum Withdrawal</label>
          <input type="number" id="minAmount" placeholder="Enter minimum amount">
        </div>
        <div class="form-group">
          <label>Maximum Withdrawal</label>
          <input type="number" id="maxAmount" placeholder="Enter maximum amount">
        </div>
        <div class="form-group" id="additionalField" style="display: none;">
          <label id="additionalLabel">Additional Info</label>
          <input type="text" id="additionalInput" placeholder="Enter additional information">
        </div>
        <button class="save-btn" onclick="saveWithdrawalMethod()">
          <i class="fas fa-save"></i> Save Method
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Check admin authentication
if(!localStorage.getItem('adminLoggedIn')) {
  window.location.href = 'admin.html';
}

// Initialize sample withdrawal data with all methods
function initializeWithdrawalData() {
  if (!localStorage.getItem('withdrawals')) {
    const sampleWithdrawals = [
      {
        id: 1,
        userId: 1,
        username: 'john_doe',
        method: 'bkash',
        account: '01712345678',
        amount: 25.50,
        date: new Date().toISOString(),
        status: 'pending',
        userBalance: 30.00
      },
      {
        id: 2,
        userId: 2,
        username: 'jane_smith',
        method: 'paypal',
        account: 'jane.smith@example.com',
        amount: 42.75,
        date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
        status: 'pending',
        userBalance: 50.00
      },
      {
        id: 3,
        userId: 3,
        username: 'mike_wilson',
        method: 'binance',
        account: 'mike_wilson123',
        amount: 15.20,
        date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
        status: 'approved',
        userBalance: 20.00
      },
      {
        id: 4,
        userId: 4,
        username: 'sarah_jones',
        method: 'bank',
        account: 'Bank: DBBL, A/C: 123456789',
        amount: 60.00,
        date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
        status: 'pending',
        userBalance: 75.00
      }
    ];
    localStorage.setItem('withdrawals', JSON.stringify(sampleWithdrawals));
  }
}

// Load users data
function loadUsersData() {
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  
  // Update stats
  document.getElementById('totalUsers').textContent = users.length;
  
  const totalEarnings = users.reduce((sum, user) => sum + (user.balance || 0), 0);
  document.getElementById('totalEarnings').textContent = '$' + totalEarnings.toFixed(2);
  
  const totalTasks = users.reduce((sum, user) => sum + (user.tasksCompleted || 0), 0);
  document.getElementById('totalTasks').textContent = totalTasks;

  // Today's signups
  const today = new Date().toDateString();
  const todayUsers = users.filter(user => new Date(user.createdAt).toDateString() === today).length;
  document.getElementById('todayUsers').textContent = todayUsers;

  // Update users table
  const tableBody = document.getElementById('usersTableBody');
  const noUsersMessage = document.getElementById('noUsersMessage');

  if (users.length === 0) {
    tableBody.innerHTML = '';
    noUsersMessage.style.display = 'block';
    return;
  }

  noUsersMessage.style.display = 'none';
  tableBody.innerHTML = '';

  users.forEach((user, index) => {
    const row = document.createElement('tr');
    
    const joinDate = new Date(user.createdAt);
    const formattedDate = joinDate.toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    });
    
    row.innerHTML = `
      <td><strong>${user.username}</strong></td>
      <td>${user.email}</td>
      <td style="color: var(--green); font-weight: 600;">$${(user.balance || 0).toFixed(2)}</td>
      <td>${formattedDate}</td>
      <td class="user-actions">
        <button class="delete-btn" onclick="deleteUser(${index})" title="Delete User">
          <i class="fas fa-trash"></i> Delete
        </button>
      </td>
    `;
    
    tableBody.appendChild(row);
  });
}

// Load withdrawal data
function loadWithdrawalData() {
  initializeWithdrawalData();
  const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
  
  const pendingCount = withdrawals.filter(w => w.status === 'pending').length;
  document.getElementById('pendingCount').textContent = `(${pendingCount} Pending)`;
  
  const tableBody = document.getElementById('withdrawalsTableBody');
  const noWithdrawalsMessage = document.getElementById('noWithdrawalsMessage');

  if (withdrawals.length === 0) {
    tableBody.innerHTML = '';
    noWithdrawalsMessage.style.display = 'block';
    return;
  }

  noWithdrawalsMessage.style.display = 'none';
  tableBody.innerHTML = '';

  withdrawals.forEach((withdrawal, index) => {
    const row = document.createElement('tr');
    
    const requestDate = new Date(withdrawal.date);
    const formattedDate = requestDate.toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
    
    let statusBadge = '';
    switch(withdrawal.status) {
      case 'pending':
        statusBadge = '<span class="status-badge status-pending">Pending</span>';
        break;
      case 'approved':
        statusBadge = '<span class="status-badge status-approved">Approved</span>';
        break;
      case 'rejected':
        statusBadge = '<span class="status-badge status-rejected">Rejected</span>';
        break;
    }
    
    let actionButtons = '';
    if (withdrawal.status === 'pending') {
      actionButtons = `
        <button class="action-btn approve-btn" onclick="approveWithdrawal(${withdrawal.id})">
          <i class="fas fa-check"></i> Approve
        </button>
        <button class="action-btn reject-btn" onclick="rejectWithdrawal(${withdrawal.id})">
          <i class="fas fa-times"></i> Reject
        </button>
      `;
    } else {
      actionButtons = '<span style="color: #bbb;">Completed</span>';
    }
    
    row.innerHTML = `
      <td><strong>${withdrawal.username}</strong></td>
      <td>${withdrawal.method}</td>
      <td>${withdrawal.account}</td>
      <td style="color: var(--green); font-weight: 600;">$${withdrawal.amount.toFixed(2)}</td>
      <td>${formattedDate}</td>
      <td>${statusBadge}</td>
      <td>$${withdrawal.userBalance.toFixed(2)}</td>
      <td>${actionButtons}</td>
    `;
    
    tableBody.appendChild(row);
  });
}

// Approve withdrawal
function approveWithdrawal(withdrawalId) {
  const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
  const withdrawal = withdrawals.find(w => w.id === withdrawalId);
  
  if (withdrawal) {
    if (confirm(`Approve $${withdrawal.amount.toFixed(2)} withdrawal for ${withdrawal.username} via ${withdrawal.method}?`)) {
      withdrawal.status = 'approved';
      localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
      
      // Update user balance (deduct the withdrawal amount)
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.username === withdrawal.username);
      if (user) {
        user.balance = (user.balance || 0) - withdrawal.amount;
        localStorage.setItem('users', JSON.stringify(users));
      }
      
      alert('Withdrawal approved successfully!');
      loadWithdrawalData();
      loadUsersData();
    }
  }
}

// Reject withdrawal
function rejectWithdrawal(withdrawalId) {
  const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
  const withdrawal = withdrawals.find(w => w.id === withdrawalId);
  
  if (withdrawal) {
    if (confirm(`Reject $${withdrawal.amount.toFixed(2)} withdrawal for ${withdrawal.username}?`)) {
      withdrawal.status = 'rejected';
      localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
      alert('Withdrawal rejected!');
      loadWithdrawalData();
    }
  }
}

// Bulk actions
function approveAllPending() {
  const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
  const pendingWithdrawals = withdrawals.filter(w => w.status === 'pending');
  
  if (pendingWithdrawals.length === 0) {
    alert('No pending withdrawals to approve!');
    return;
  }
  
  if (confirm(`Approve all ${pendingWithdrawals.length} pending withdrawals?`)) {
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    
    pendingWithdrawals.forEach(withdrawal => {
      withdrawal.status = 'approved';
      
      // Update user balances
      const user = users.find(u => u.username === withdrawal.username);
      if (user) {
        user.balance = (user.balance || 0) - withdrawal.amount;
      }
    });
    
    localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
    localStorage.setItem('users', JSON.stringify(users));
    
    alert(`Approved ${pendingWithdrawals.length} withdrawals successfully!`);
    loadWithdrawalData();
    loadUsersData();
  }
}

function rejectAllPending() {
  const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
  const pendingWithdrawals = withdrawals.filter(w => w.status === 'pending');
  
  if (pendingWithdrawals.length === 0) {
    alert('No pending withdrawals to reject!');
    return;
  }
  
  if (confirm(`Reject all ${pendingWithdrawals.length} pending withdrawals?`)) {
    pendingWithdrawals.forEach(withdrawal => {
      withdrawal.status = 'rejected';
    });
    
    localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
    alert(`Rejected ${pendingWithdrawals.length} withdrawals!`);
    loadWithdrawalData();
  }
}

// Delete user function
function deleteUser(index) {
  if(confirm('Are you sure you want to delete this user? This action cannot be undone!')) {
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const deletedUser = users[index];
    users.splice(index, 1);
    localStorage.setItem('users', JSON.stringify(users));
    
    alert(`User "${deletedUser.username}" has been deleted successfully!`);
    loadUsersData();
  }
}

// Export users data
function exportUsers() {
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  
  if (users.length === 0) {
    alert('No users data to export!');
    return;
  }

  const csvContent = "data:text/csv;charset=utf-8," 
    + "Username,Email,Balance,Tasks Completed,Join Date\n"
    + users.map(user => 
        `"${user.username}","${user.email}",${user.balance || 0},${user.tasksCompleted || 0},"${user.createdAt}"`
      ).join("\n");
  
  const encodedUri = encodeURI(csvContent);
  const link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", `wincash_users_${new Date().toISOString().split('T')[0]}.csv`);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// Admin logout
function adminLogout() {
  if(confirm('Are you sure you want to logout?')) {
    localStorage.removeItem('adminLoggedIn');
    window.location.href = 'admin.html';
  }
}

// Withdrawal Methods Functions
let selectedMethod = '';

function openWithdrawalMethods() {
  document.getElementById('withdrawalModal').style.display = 'flex';
  document.body.classList.add('modal-open');
}

function closeModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
  document.body.classList.remove('modal-open');
  resetMethodForm();
}

function selectMethod(method) {
  selectedMethod = method;
  
  document.querySelectorAll('.payment-method').forEach(el => {
    el.classList.remove('selected');
  });
  
  event.currentTarget.classList.add('selected');
  
  const form = document.getElementById('methodForm');
  const label = document.getElementById('methodLabel');
  const input = document.getElementById('accountInput');
  const additionalField = document.getElementById('additionalField');
  
  form.style.display = 'block';
  
  // Reset additional field
  additionalField.style.display = 'none';
  document.getElementById('additionalInput').value = '';
  
  switch(method) {
    case 'bkash':
    case 'nagad':
    case 'rocket':
    case 'upay':
      label.textContent = 'Mobile Number';
      input.placeholder = 'Enter mobile number (e.g., 01712345678)';
      break;
    case 'paypal':
    case 'payoneer':
    case 'skrill':
    case 'neteller':
      label.textContent = 'Email Address';
      input.placeholder = 'Enter email address';
      break;
    case 'binance':
      label.textContent = 'Binance ID';
      input.placeholder = 'Enter Binance ID';
      additionalField.style.display = 'block';
      document.getElementById('additionalLabel').textContent = 'Wallet Address';
      document.getElementById('additionalInput').placeholder = 'Enter crypto wallet address';
      break;
    case 'perfect-money':
    case 'webmoney':
      label.textContent = 'Account Number';
      input.placeholder = 'Enter account number';
      break;
    case 'crypto':
      label.textContent = 'Wallet Address';
      input.placeholder = 'Enter crypto wallet address';
      additionalField.style.display = 'block';
      document.getElementById('additionalLabel').textContent = 'Network Type';
      document.getElementById('additionalInput').placeholder = 'e.g., ERC20, BEP20, TRC20';
      break;
    case 'bank':
      label.textContent = 'Bank Account';
      input.placeholder = 'Enter bank account number';
      additionalField.style.display = 'block';
      document.getElementById('additionalLabel').textContent = 'Bank Details';
      document.getElementById('additionalInput').placeholder = 'Bank name, branch, routing number';
      break;
  }
}

function resetMethodForm() {
  selectedMethod = '';
  document.querySelectorAll('.payment-method').forEach(el => {
    el.classList.remove('selected');
  });
  document.getElementById('methodForm').style.display = 'none';
  document.getElementById('accountInput').value = '';
  document.getElementById('minAmount').value = '';
  document.getElementById('maxAmount').value = '';
  document.getElementById('additionalInput').value = '';
  document.getElementById('additionalField').style.display = 'none';
}

function saveWithdrawalMethod() {
  const account = document.getElementById('accountInput').value;
  const minAmount = document.getElementById('minAmount').value;
  const maxAmount = document.getElementById('maxAmount').value;
  const additionalInfo = document.getElementById('additionalInput').value;
  
  if (!account || !minAmount || !maxAmount) {
    alert('Please fill in all required fields!');
    return;
  }
  
  const methods = JSON.parse(localStorage.getItem('withdrawalMethods') || '{}');
  methods[selectedMethod] = {
    account: account,
    minAmount: parseFloat(minAmount),
    maxAmount: parseFloat(maxAmount),
    additionalInfo: additionalInfo,
    enabled: true
  };
  
  localStorage.setItem('withdrawalMethods', JSON.stringify(methods));
  
  alert(`${selectedMethod.charAt(0).toUpperCase() + selectedMethod.slice(1)} withdrawal method saved successfully!`);
  closeModal('withdrawalModal');
}

// Close modal when clicking outside
document.addEventListener('click', function(event) {
  const modal = document.getElementById('withdrawalModal');
  if (event.target === modal) {
    closeModal('withdrawalModal');
  }
});

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeModal('withdrawalModal');
  }
});

// Load data when page loads
window.addEventListener('DOMContentLoaded', function() {
  loadUsersData();
  loadWithdrawalData();
});

// Auto refresh every 30 seconds
setInterval(function() {
  loadUsersData();
  loadWithdrawalData();
}, 30000);
</script>

</body>
</html>


